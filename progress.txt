## 2026-01-06: Income Management Backend

Implemented income management backend feature (PRD item #3):

### Added files:
- packages/db/src/schemas/incomes.ts - income table schema with period enum (daily/weekly/monthly/yearly)
- apps/backend/src/routers/income/service.ts - CRUD service for incomes
- apps/backend/src/routers/income/controller.ts - REST endpoints (GET/POST/PATCH/DELETE /incomes)

### Modified files:
- packages/db/src/schemas/index.ts - export incomes
- packages/db/src/types.ts - Income types + zod schemas
- packages/db/src/relations.ts - user-income relation
- apps/backend/src/index.ts - register incomesRouter

### Notes for next dev:
- Period validation via pgEnum (drizzle handles invalid values)
- User filtering enforced in controller via auth middleware
- Next feature: Income UI (PRD item #4) or Personal expense backend (PRD item #5)

## 2026-01-06: Income Management UI

Implemented income management UI (PRD item #4):

### Added files:
- apps/web/src/lib/queries/incomes.queries.ts - query options for fetching incomes
- apps/web/src/lib/mutations/incomes.mutations.ts - mutations for create/update/delete
- apps/web/src/components/income/income-list.tsx - list of incomes
- apps/web/src/components/income/income-item.tsx - single income row with edit/delete
- apps/web/src/components/income/add-income-form.tsx - form to add new income
- apps/web/src/components/income/edit-income-dialog.tsx - dialog to edit income
- apps/web/src/components/income/income-list-card.tsx - card wrapper for income UI
- apps/web/src/routes/incomes.tsx - /incomes route page

### Modified files:
- apps/web/src/lib/queries/keys.ts - added incomes query keys
- apps/web/src/components/navigation/navbar.tsx - added Incomes link for logged-in users

### Notes for next dev:
- Period displayed as €X/mo, €X/week etc via formatAmount helper
- Edit dialog supports optional end_date
- No delete confirmation modal (inline delete like todos) - simple UX
- Next feature: Personal expense backend (PRD item #5)

## 2026-01-10: Personal Expense Management Backend

Implemented expense backend (PRD item #5):

### Added files:
- packages/db/src/schemas/expenses.ts - expense table w/ type enum (one_time/recurring), period enum, active flag
- apps/backend/src/routers/expense/service.ts - CRUD service
- apps/backend/src/routers/expense/controller.ts - REST endpoints w/ validation (one_time needs targetDate, recurring needs period+startDate)

### Modified files:
- packages/db/src/schemas/index.ts - export expenses
- packages/db/src/types.ts - Expense types + zod schemas
- packages/db/src/relations.ts - user-expense relation
- apps/backend/src/index.ts - register expensesRouter

### Notes for next dev:
- Schema has householdId (nullable) + active flag for future household features
- targetDate used for one_time, startDate/endDate/period for recurring
- Validation in controller via zod refine
- Next feature: Personal expense UI (PRD item #6)

## 2026-01-10: Personal Expense Management UI

Implemented expense UI (PRD item #6):

### Added files:
- apps/web/src/lib/queries/expenses.queries.ts - query options for expenses
- apps/web/src/lib/mutations/expenses.mutations.ts - create/update/delete mutations
- apps/web/src/components/expense/expense-fields.tsx - form fields w/ type toggle (one-time/recurring), uses withForm composition
- apps/web/src/components/expense/expense-list.tsx - list of expenses
- apps/web/src/components/expense/expense-item.tsx - expense row w/ type icons (CalendarDays/Repeat), remaining duration display
- apps/web/src/components/expense/add-expense-form.tsx - add expense form
- apps/web/src/components/expense/edit-expense-dialog.tsx - edit dialog
- apps/web/src/components/expense/expense-list-card.tsx - card wrapper
- apps/web/src/components/ui/alert-dialog.tsx - alert dialog component (base-ui)
- apps/web/src/routes/expenses.tsx - /expenses route

### Modified files:
- apps/web/src/lib/queries/keys.ts - added expenses query keys
- apps/web/src/components/navigation/navbar.tsx - added Expenses link

### Notes for next dev:
- Type toggle shows/hides fields dynamically via form.Subscribe
- One-time shows targetDate, recurring shows period+startDate+endDate
- Delete uses AlertDialog w/ confirmation
- Remaining duration calc shows "X months left" for recurring w/ endDate
- Type icons: CalendarDays for one_time, Repeat for recurring
- Next feature: Pocket management backend (PRD item #7)

## 2026-01-10: Pocket Management Backend

Implemented pocket backend (PRD item #7):

### Added files:
- packages/db/src/schemas/pockets.ts - pocket table (id, userId, name, amount, timestamps)
- apps/backend/src/routers/pocket/service.ts - CRUD service
- apps/backend/src/routers/pocket/controller.ts - REST endpoints (GET/POST/PATCH/DELETE /pockets)

### Modified files:
- packages/db/src/schemas/index.ts - export pockets
- packages/db/src/types.ts - Pocket types + zod schemas
- packages/db/src/relations.ts - user-pocket relation
- apps/backend/src/index.ts - register pocketsRouter

### Notes for next dev:
- Simple schema: name + amount only (no period/dates like income/expense)
- User filtering via auth middleware
- Next feature: Pocket UI (PRD item #8)

## 2026-01-10: Pocket Management UI

Implemented pocket UI (PRD item #8):

### Added files:
- apps/web/src/lib/queries/pockets.queries.ts - query options for pockets
- apps/web/src/lib/mutations/pockets.mutations.ts - create/update/delete mutations
- apps/web/src/components/pocket/pocket-fields.tsx - form fields using withFieldGroup
- apps/web/src/components/pocket/pocket-list.tsx - list of pockets
- apps/web/src/components/pocket/pocket-item.tsx - pocket row w/ Wallet icon, edit/delete
- apps/web/src/components/pocket/add-pocket-form.tsx - add pocket form
- apps/web/src/components/pocket/edit-pocket-dialog.tsx - edit dialog
- apps/web/src/components/pocket/pocket-list-card.tsx - card wrapper
- apps/web/src/routes/pockets.tsx - /pockets route

### Modified files:
- apps/web/src/lib/queries/keys.ts - added pockets query keys
- apps/web/src/components/navigation/navbar.tsx - added Pockets link

### Notes for next dev:
- Simple form: name + amount only (no period/dates)
- Wallet icon for pocket items
- Delete uses AlertDialog w/ confirmation
- Displayed as budget cards per PRD requirement
- Next feature: Household backend (PRD item #9)

## 2026-01-11: Household Creation and Membership Backend

Implemented household backend (PRD item #9):

### Added files:
- packages/db/src/schemas/households.ts - household + household_members tables, split_mode enum (equal/income_proportional)
- apps/backend/src/routers/household/service.ts - CRUD + membership service
- apps/backend/src/routers/household/controller.ts - REST endpoints (GET /households/me, POST /households, PATCH /households/:id, DELETE /households/:id/leave)

### Modified files:
- packages/db/src/schemas/index.ts - export households
- packages/db/src/schemas/expenses.ts - added FK reference to households
- packages/db/src/types.ts - Household, HouseholdMember types + zod schemas, SplitMode enum
- packages/db/src/relations.ts - household/member/expense relations
- apps/backend/src/index.ts - register householdsRouter

### Notes for next dev:
- User can only be in one household (checked on create)
- Leave disables user's household expenses (active=false)
- Household auto-deleted when last member leaves
- Expenses table already had householdId (nullable) + active flag from expense backend
- Next feature: Household invitation system (PRD item #10)

## 2026-01-11: Household Invitation System Backend

Implemented invitation backend (PRD item #10):

### Added files:
- apps/backend/src/routers/invitation/service.ts - invitation CRUD, token gen, expiration utils
- apps/backend/src/routers/invitation/controller.ts - REST endpoints (GET/POST invitations, accept/decline via token)

### Modified files:
- packages/db/src/schemas/households.ts - added invitations table + invitation_status enum
- packages/db/src/types.ts - Invitation types + zod schemas
- packages/db/src/relations.ts - invitation relations (household, inviter)
- apps/backend/src/index.ts - register invitationsRouter

### Endpoints:
- GET /invitations - pending invitations for user's household
- GET /invitations/pending - pending invitations sent TO current user
- GET /invitations/token/:token - get invitation by token (public for landing page)
- POST /invitations - send invitation (requires household membership)
- POST /invitations/token/:token/accept - accept invitation (adds user to household)
- POST /invitations/token/:token/decline - decline invitation

### Notes for next dev:
- Token is UUID, expires in 7 days by default
- Can't invite if already pending invite for same email/household
- Accept fails if user already in a household
- Status transitions: pending -> accepted/declined/expired
- Next feature: Household management UI (PRD item #11)

## 2026-01-11: Household Management UI

Implemented household UI (PRD item #11):

### Added files:
- apps/web/src/lib/queries/households.queries.ts - query options for household and invitations
- apps/web/src/lib/mutations/households.mutations.ts - mutations for create/update/leave/invite
- apps/web/src/components/household/member-item.tsx - member row component
- apps/web/src/components/household/member-list.tsx - members list
- apps/web/src/components/household/invite-form.tsx - email invite form
- apps/web/src/components/household/pending-invitation-item.tsx - pending invite row
- apps/web/src/components/household/pending-invitations.tsx - pending invites list
- apps/web/src/components/household/split-mode-toggle.tsx - split mode selector
- apps/web/src/components/household/leave-household-button.tsx - leave w/ confirmation
- apps/web/src/components/household/create-household-form.tsx - create household form
- apps/web/src/components/household/household-settings.tsx - main settings card
- apps/web/src/routes/household.tsx - /household route

### Modified files:
- apps/web/src/lib/queries/keys.ts - added households/invitations query keys
- apps/web/src/components/navigation/navbar.tsx - added Household link

### Notes for next dev:
- Split mode toggle updates household immediately (no save button)
- Leave button uses AlertDialog confirmation
- Create form shown when user has no household
- Pending invitations fetched via separate query
- Next feature: Household invitation flow UI (PRD item #12)

## 2026-01-11: Household Invitation Flow UI

Implemented invitation flow UI (PRD item #12):

### Added files:
- apps/web/src/routes/invite.$token.tsx - invitation landing page at /invite/:token

### Features:
- Displays household name and inviter info
- Accept/decline buttons with loading states
- Handles already-in-household error with user-friendly message
- Redirects to dashboard on accept/decline
- Shows login prompt if not authenticated
- Shows error state for invalid/expired invitations

### Notes for next dev:
- Uses existing invitationByTokenOptions query and accept/declineInvitationOptions mutations
- Route pattern: /invite/$token (TanStack Router dynamic param)
- Next feature: Household expense backend (PRD item #13)

## 2026-01-11: Household Expense Management Backend

Implemented household expense backend (PRD item #13):

### Modified files:
- apps/backend/src/routers/expense/service.ts - added getHouseholdExpenses, updated getUserExpenses to filter out household expenses
- apps/backend/src/routers/expense/controller.ts - added household expense CRUD endpoints

### Endpoints:
- GET /household-expenses - get expenses for user's household
- POST /household-expenses - create household expense
- PATCH /household-expenses/:id - update household expense
- DELETE /household-expenses/:id - delete household expense

### Notes for next dev:
- Expense table already had householdId (nullable) + active flag from prior work
- Routes use /household-expenses (not /households/:id/expenses) to avoid Eden type conflicts
- Membership validated via HouseholdsService.getUserMembership
- Personal expense list now filters out household expenses (householdId IS NULL)
- Next feature: Household expense UI (PRD item #14)

## 2026-01-11: Household Expense UI

Implemented household expense UI (PRD item #14):

### Added files:
- apps/web/src/components/household-expense/household-expense-item.tsx - expense row w/ split amount, disabled indicator
- apps/web/src/components/household-expense/household-expense-list.tsx - list component
- apps/web/src/components/household-expense/add-household-expense-form.tsx - add expense form (reuses ExpenseFields)
- apps/web/src/components/household-expense/edit-household-expense-dialog.tsx - edit dialog
- apps/web/src/components/household-expense/household-expense-card.tsx - main card w/ household context
- apps/web/src/lib/utils/expense-format.ts - shared formatting utils (extracted from expense/household-expense items)

### Modified files:
- apps/web/src/lib/queries/keys.ts - added householdExpenses query keys
- apps/web/src/lib/queries/households.queries.ts - added householdExpenseListOptions
- apps/web/src/lib/mutations/households.mutations.ts - added create/update/delete household expense mutations
- apps/web/src/routes/household.tsx - added HouseholdExpenseCard below HouseholdSettings
- apps/web/src/components/expense/expense-fields.tsx - added toExpensePayload, expenseToFormValues helpers
- apps/web/src/components/expense/expense-item.tsx - uses shared expense-format utils

### Features:
- Expense list with equal split display (€X each) or "by income" indicator
- Disabled expenses from member departure show amber warning icon + "Disabled" badge + 50% opacity
- Edit button disabled for disabled expenses
- Delete confirmation dialog
- Reuses ExpenseFields for consistent form experience

### Notes for next dev:
- Household expense card only shows when user has a household
- Split calculation currently shows equal split; income-proportional just shows "by income" (actual calc in future PRD)
- Shared utils extracted to reduce duplication across expense/household-expense items
- Next feature: Monthly balance calculation engine (PRD item #15)

## 2026-01-11: Monthly Balance Calculation Engine

Implemented balance calculation backend (PRD item #15):

### Added files:
- apps/backend/src/routers/balance/service.ts - calculation engine
- apps/backend/src/routers/balance/controller.ts - GET /balance/:year/:month endpoint

### Modified files:
- apps/backend/src/index.ts - registered balanceRouter

### Features:
- toMonthlyAmount() converts daily/weekly/monthly/yearly to monthly equiv
- isActiveInMonth() checks if recurring item active during month (respects start/end dates)
- isInMonth() checks if one-time date falls in month
- calcMonthlyIncome() - sum user's active incomes for month
- calcPersonalExpenses() - sum personal one-time + recurring expenses for month
- calcHouseholdShare() - compute user's share based on split mode (equal or income_proportional)
- calcPocketsTotal() - sum all user's pocket amounts
- Returns: income, personalExpenses, householdShare, pockets, remaining

### Notes for next dev:
- Period conversion: daily*30.44, weekly*4.35, yearly/12
- Income-proportional falls back to equal split if total income=0
- Endpoint at GET /balance/:year/:month (auth required)
- Next feature: Future month projections (PRD item #16) or Monthly dashboard UI (PRD item #18)

## 2026-01-11: Monthly Dashboard View

Implemented dashboard UI (PRD item #18):

### Added files:
- apps/web/src/lib/queries/balance.queries.ts - query options for balance endpoint
- apps/web/src/lib/utils/format-currency.ts - Intl.NumberFormat currency formatter
- apps/web/src/components/dashboard/balance-row.tsx - expandable row w/ colored amounts
- apps/web/src/components/dashboard/balance-item.tsx - individual item in expanded list
- apps/web/src/components/dashboard/dashboard-overview.tsx - main dashboard card w/ month nav
- apps/web/src/routes/dashboard.tsx - /dashboard route

### Modified files:
- apps/web/src/lib/queries/keys.ts - added balance query keys
- apps/web/src/components/navigation/navbar.tsx - added Dashboard link

### Features:
- Month navigation (prev/next) w/ ChevronLeft/ChevronRight buttons
- Income shown in green, negative remaining in red
- Expandable sections for personal expenses, household share, pockets
- Red warning Alert when remaining is negative (deficit)
- Uses existing balance calculation engine

### Notes for next dev:
- Dashboard is first nav link for logged-in users
- Future: add badges for past/future months (snapshots/projections)
- Next feature: Future month projections (PRD #16), Monthly snapshot system (PRD #17), or Dashboard warnings (PRD #21)

## 2026-01-11: Future Month Projections Backend

Implemented projection backend (PRD item #16):

### Modified files:
- apps/backend/src/routers/balance/service.ts - added getProjection() method
- apps/backend/src/routers/balance/controller.ts - added GET /balance/projection/:year/:month/:months endpoint

### Endpoint:
- GET /balance/projection/:year/:month/:months - returns array of MonthlyBalance for N months starting from given month

### Notes for next dev:
- Projections reuse getMonthlyBalance() which already handles future months correctly
- Incomes/expenses respect start_date/end_date
- Pockets applied as current values (no date projection)
- Max 24 months projection
- Also marked PRD #22 (expense recurrence logic) and #23 (income-proportional split) as done - already implemented in balance service
- Next feature: Monthly snapshot system (PRD #17), Future projection view UI (PRD #20), or Dashboard warnings (PRD #21)

## 2026-01-11: Navigation and Layout UI

Implemented responsive navigation (PRD item #24):

### Added files:
- apps/web/src/components/navigation/mobile-nav.tsx - hamburger menu for mobile, shows nav links in dropdown
- apps/web/src/components/navigation/user-menu.tsx - user dropdown w/ account link + logout
- apps/web/src/components/navigation/household-badge.tsx - badge showing household name (if member)

### Modified files:
- apps/web/src/components/navigation/navbar.tsx - integrated all nav components, responsive layout

### Features:
- Desktop: horizontal nav links hidden on mobile (md:flex)
- Mobile: hamburger menu expands to show nav links
- User menu dropdown w/ Settings icon -> Account, LogOut -> Logout
- Household badge shows next to theme switcher when user is in a household
- App renamed from "Awesome Todo App" to "FinTrack"
- Added border-b to header for visual separation

### Notes for next dev:
- Mobile nav closes on link click
- Admin link visible only to admin users
- Household badge queries householdMeOptions (cached)
- Next features remaining: Monthly snapshot system (PRD #17), Past month snapshot view (PRD #19), Future projection view (PRD #20), Dashboard warnings (PRD #21), Member departure handling (PRD #25)
