## 2026-01-06: Income Management Backend

Implemented income management backend feature (PRD item #3):

### Added files:
- packages/db/src/schemas/incomes.ts - income table schema with period enum (daily/weekly/monthly/yearly)
- apps/backend/src/routers/income/service.ts - CRUD service for incomes
- apps/backend/src/routers/income/controller.ts - REST endpoints (GET/POST/PATCH/DELETE /incomes)

### Modified files:
- packages/db/src/schemas/index.ts - export incomes
- packages/db/src/types.ts - Income types + zod schemas
- packages/db/src/relations.ts - user-income relation
- apps/backend/src/index.ts - register incomesRouter

### Notes for next dev:
- Period validation via pgEnum (drizzle handles invalid values)
- User filtering enforced in controller via auth middleware
- Next feature: Income UI (PRD item #4) or Personal expense backend (PRD item #5)

## 2026-01-06: Income Management UI

Implemented income management UI (PRD item #4):

### Added files:
- apps/web/src/lib/queries/incomes.queries.ts - query options for fetching incomes
- apps/web/src/lib/mutations/incomes.mutations.ts - mutations for create/update/delete
- apps/web/src/components/income/income-list.tsx - list of incomes
- apps/web/src/components/income/income-item.tsx - single income row with edit/delete
- apps/web/src/components/income/add-income-form.tsx - form to add new income
- apps/web/src/components/income/edit-income-dialog.tsx - dialog to edit income
- apps/web/src/components/income/income-list-card.tsx - card wrapper for income UI
- apps/web/src/routes/incomes.tsx - /incomes route page

### Modified files:
- apps/web/src/lib/queries/keys.ts - added incomes query keys
- apps/web/src/components/navigation/navbar.tsx - added Incomes link for logged-in users

### Notes for next dev:
- Period displayed as €X/mo, €X/week etc via formatAmount helper
- Edit dialog supports optional end_date
- No delete confirmation modal (inline delete like todos) - simple UX
- Next feature: Personal expense backend (PRD item #5)

## 2026-01-10: Personal Expense Management Backend

Implemented expense backend (PRD item #5):

### Added files:
- packages/db/src/schemas/expenses.ts - expense table w/ type enum (one_time/recurring), period enum, active flag
- apps/backend/src/routers/expense/service.ts - CRUD service
- apps/backend/src/routers/expense/controller.ts - REST endpoints w/ validation (one_time needs targetDate, recurring needs period+startDate)

### Modified files:
- packages/db/src/schemas/index.ts - export expenses
- packages/db/src/types.ts - Expense types + zod schemas
- packages/db/src/relations.ts - user-expense relation
- apps/backend/src/index.ts - register expensesRouter

### Notes for next dev:
- Schema has householdId (nullable) + active flag for future household features
- targetDate used for one_time, startDate/endDate/period for recurring
- Validation in controller via zod refine
- Next feature: Personal expense UI (PRD item #6)

## 2026-01-10: Personal Expense Management UI

Implemented expense UI (PRD item #6):

### Added files:
- apps/web/src/lib/queries/expenses.queries.ts - query options for expenses
- apps/web/src/lib/mutations/expenses.mutations.ts - create/update/delete mutations
- apps/web/src/components/expense/expense-fields.tsx - form fields w/ type toggle (one-time/recurring), uses withForm composition
- apps/web/src/components/expense/expense-list.tsx - list of expenses
- apps/web/src/components/expense/expense-item.tsx - expense row w/ type icons (CalendarDays/Repeat), remaining duration display
- apps/web/src/components/expense/add-expense-form.tsx - add expense form
- apps/web/src/components/expense/edit-expense-dialog.tsx - edit dialog
- apps/web/src/components/expense/expense-list-card.tsx - card wrapper
- apps/web/src/components/ui/alert-dialog.tsx - alert dialog component (base-ui)
- apps/web/src/routes/expenses.tsx - /expenses route

### Modified files:
- apps/web/src/lib/queries/keys.ts - added expenses query keys
- apps/web/src/components/navigation/navbar.tsx - added Expenses link

### Notes for next dev:
- Type toggle shows/hides fields dynamically via form.Subscribe
- One-time shows targetDate, recurring shows period+startDate+endDate
- Delete uses AlertDialog w/ confirmation
- Remaining duration calc shows "X months left" for recurring w/ endDate
- Type icons: CalendarDays for one_time, Repeat for recurring
- Next feature: Pocket management backend (PRD item #7)

## 2026-01-10: Pocket Management Backend

Implemented pocket backend (PRD item #7):

### Added files:
- packages/db/src/schemas/pockets.ts - pocket table (id, userId, name, amount, timestamps)
- apps/backend/src/routers/pocket/service.ts - CRUD service
- apps/backend/src/routers/pocket/controller.ts - REST endpoints (GET/POST/PATCH/DELETE /pockets)

### Modified files:
- packages/db/src/schemas/index.ts - export pockets
- packages/db/src/types.ts - Pocket types + zod schemas
- packages/db/src/relations.ts - user-pocket relation
- apps/backend/src/index.ts - register pocketsRouter

### Notes for next dev:
- Simple schema: name + amount only (no period/dates like income/expense)
- User filtering via auth middleware
- Next feature: Pocket UI (PRD item #8)

## 2026-01-10: Pocket Management UI

Implemented pocket UI (PRD item #8):

### Added files:
- apps/web/src/lib/queries/pockets.queries.ts - query options for pockets
- apps/web/src/lib/mutations/pockets.mutations.ts - create/update/delete mutations
- apps/web/src/components/pocket/pocket-fields.tsx - form fields using withFieldGroup
- apps/web/src/components/pocket/pocket-list.tsx - list of pockets
- apps/web/src/components/pocket/pocket-item.tsx - pocket row w/ Wallet icon, edit/delete
- apps/web/src/components/pocket/add-pocket-form.tsx - add pocket form
- apps/web/src/components/pocket/edit-pocket-dialog.tsx - edit dialog
- apps/web/src/components/pocket/pocket-list-card.tsx - card wrapper
- apps/web/src/routes/pockets.tsx - /pockets route

### Modified files:
- apps/web/src/lib/queries/keys.ts - added pockets query keys
- apps/web/src/components/navigation/navbar.tsx - added Pockets link

### Notes for next dev:
- Simple form: name + amount only (no period/dates)
- Wallet icon for pocket items
- Delete uses AlertDialog w/ confirmation
- Displayed as budget cards per PRD requirement
- Next feature: Household backend (PRD item #9)

## 2026-01-11: Household Creation and Membership Backend

Implemented household backend (PRD item #9):

### Added files:
- packages/db/src/schemas/households.ts - household + household_members tables, split_mode enum (equal/income_proportional)
- apps/backend/src/routers/household/service.ts - CRUD + membership service
- apps/backend/src/routers/household/controller.ts - REST endpoints (GET /households/me, POST /households, PATCH /households/:id, DELETE /households/:id/leave)

### Modified files:
- packages/db/src/schemas/index.ts - export households
- packages/db/src/schemas/expenses.ts - added FK reference to households
- packages/db/src/types.ts - Household, HouseholdMember types + zod schemas, SplitMode enum
- packages/db/src/relations.ts - household/member/expense relations
- apps/backend/src/index.ts - register householdsRouter

### Notes for next dev:
- User can only be in one household (checked on create)
- Leave disables user's household expenses (active=false)
- Household auto-deleted when last member leaves
- Expenses table already had householdId (nullable) + active flag from expense backend
- Next feature: Household invitation system (PRD item #10)

## 2026-01-11: Household Invitation System Backend

Implemented invitation backend (PRD item #10):

### Added files:
- apps/backend/src/routers/invitation/service.ts - invitation CRUD, token gen, expiration utils
- apps/backend/src/routers/invitation/controller.ts - REST endpoints (GET/POST invitations, accept/decline via token)

### Modified files:
- packages/db/src/schemas/households.ts - added invitations table + invitation_status enum
- packages/db/src/types.ts - Invitation types + zod schemas
- packages/db/src/relations.ts - invitation relations (household, inviter)
- apps/backend/src/index.ts - register invitationsRouter

### Endpoints:
- GET /invitations - pending invitations for user's household
- GET /invitations/pending - pending invitations sent TO current user
- GET /invitations/token/:token - get invitation by token (public for landing page)
- POST /invitations - send invitation (requires household membership)
- POST /invitations/token/:token/accept - accept invitation (adds user to household)
- POST /invitations/token/:token/decline - decline invitation

### Notes for next dev:
- Token is UUID, expires in 7 days by default
- Can't invite if already pending invite for same email/household
- Accept fails if user already in a household
- Status transitions: pending -> accepted/declined/expired
- Next feature: Household management UI (PRD item #11)
